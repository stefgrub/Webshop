<!DOCTYPE html>
<html lang="de"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">

<head th:fragment="head(title)">
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title th:text="${title} ?: ${shopName}">[[${shopName}]]</title>

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link th:href="@{/css/site.css}" rel="stylesheet"/>
    <link th:href="@{/css/modern.css}" rel="stylesheet"/>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script defer th:src="@{/js/modern.js}"></script>

    <!-- Theme-Init (mÃ¶glichst frÃ¼h) -->
    <script>
        (function () {
          const key = 'webshop_theme';
          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          const saved = localStorage.getItem(key);
          const theme = saved || (prefersDark ? 'dark' : 'light');
          document.documentElement.setAttribute('data-theme', theme);
          document.documentElement.style.colorScheme = theme;
        })();
    </script>
</head>

<body>

<header th:fragment="header" class="navbar">
    <div class="container flex between align-center">
        <a th:href="@{/}" class="brand" th:text="${shopName}">Mein Webshop</a>

        <nav class="nav-links flex align-center gap-sm">
            <a th:href="@{/}" class="link">Start</a>
            <a th:href="@{/cart}" class="link">Warenkorb</a>

            <div sec:authorize="isAuthenticated()" class="user-info">
                <span>ðŸ‘¤ [[${#authentication.name}]]</span>
                <form th:action="@{/logout}" method="post" style="display:inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn ghost">Logout</button>
                </form>
            </div>

            <div sec:authorize="isAnonymous()">
                <a th:href="@{/login}" class="btn ghost small">Login</a>
                <a th:href="@{/register}" class="btn ghost small">Registrieren</a>
            </div>

            <div sec:authorize="hasRole('ADMIN')">
                <a th:href="@{/admin}" class="btn small">Adminbereich</a>
            </div>

            <!-- Dark-Mode Toggle -->
            <button class="btn ghost small" onclick="toggleTheme()" aria-label="Theme umschalten">ðŸŒ“</button>
        </nav>
    </div>
</header>

<main class="container" th:fragment="content">
    <!-- Inhalt der Unterseiten wird hier eingefÃ¼gt -->
</main>

<footer th:fragment="footer" class="footer">
    <div class="footer-grid">
        <div>
            <strong th:text="${shopName}">WebShop</strong>
            <p class="muted">Gute Produkte. Faire Preise.</p>
        </div>
        <div>
            <span class="muted">Service</span><br/>
            <a href="#" class="link">Versand & RÃ¼ckgabe</a><br/>
            <a href="#" class="link">Support</a>
        </div>
        <div>
            <span class="muted">Rechtliches</span><br/>
            <a href="#" class="link">AGB</a><br/>
            <a href="#" class="link">Datenschutz</a>
        </div>
    </div>
    <div class="footer-meta">
        <span>&copy; <span th:text="${#dates.format(#dates.createNow(), 'yyyy')}">2025</span> [[${shopName}]]</span>
    </div>
</footer>

<!-- Globale Fragment-Includes -->
<div th:replace="~{fragments/_toasts :: _}"></div>
<div th:replace="~{fragments/_cartDrawer :: _}"></div>
<div th:replace="~{fragments/_liveSearch :: _}"></div>

<script>
    function toggleTheme() {
      const key = 'webshop_theme';
      const html = document.documentElement;
      const current = html.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      html.style.colorScheme = next;
      localStorage.setItem(key, next);
    }
</script>

</body>
</html>
