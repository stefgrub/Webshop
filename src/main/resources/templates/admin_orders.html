<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="de">
<head th:replace="~{layout :: head('Admin – Bestellungen')}"></head>
<body>
<header th:replace="~{layout :: header}"></header>

<main class="container">

    <div class="admin-toolbar glass">
        <div class="row between align-center">
            <h1>📦 Bestellungen verwalten</h1>
            <form class="filter" th:action="@{/admin/orders}" method="get">
                <label for="status">Filtern nach Status:</label>
                <select id="status" name="status" onchange="this.form.submit()">
                    <option th:selected="${selectedStatus == null or selectedStatus == ''}" value="">Alle</option>
                    <option th:each="s : ${statuses}" th:value="${s}" th:text="${s}" th:selected="${selectedStatus == s}"></option>
                </select>
            </form>
        </div>
    </div>
    <section class="card glass">
        <div class="table-wrap">
            <table class="table orders" th:if="${!#lists.isEmpty(orders)}">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Kunde</th>
                    <th>Datum</th>
                    <th>Status</th>
                    <th>Gesamt</th>
                    <th>Aktionen</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="o : ${orders}">
                    <td th:text="${o.id}"></td>
                    <td th:text="${o.fullName}"></td>
                    <td th:text="${#temporals.format(o.createdAt, 'dd.MM.yyyy HH:mm')}"></td>
                    <td>
                        <form th:action="@{'/admin/orders/' + ${o.id} + '/status'}" method="post" class="inline">
                            <select name="status" onchange="this.form.submit()">
                                <option th:each="s : ${statuses}" th:value="${s}" th:text="${s}" th:selected="${o.status == s}"></option>
                            </select>
                            <input type="hidden" name="_csrf" th:value="${_csrf.token}" />
                        </form>
                    </td>
                    <td th:text="${#numbers.formatDecimal(o.totalCents / 100.0, 1, 'COMMA', 2, 'POINT')} + ' €'"></td>
                    <td class="actions">
                        <a th:href="@{'/admin/orders/' + ${o.id}}" class="btn small" title="Details">🔍</a>
                        <form th:if="${!o.canceled}" th:action="@{/admin/orders/cancel/{id}(id=${o.id})}" method="post" class="inline">
                            <input type="hidden" name="_csrf" th:value="${_csrf.token}" />
                        </form>
                        <form th:action="@{/admin/orders/delete/{id}(id=${o.id})}" method="post" class="inline" onsubmit="return confirm('Diese Bestellung wirklich löschen?');">
                            <input type="hidden" name="_csrf" th:value="${_csrf.token}" />
                            <button type="submit" class="btn small danger" title="Löschen">🗑️</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>
    <div th:if="${#lists.isEmpty(orders)}" class="muted">Keine Bestellungen vorhanden.</div>
</main>

<footer th:replace="~{layout :: footer}"></footer>

<!-- 🔹 Mini-Feedback-Animation für Statuswechsel --> <script> document.addEventListener('DOMContentLoaded', () => { document.querySelectorAll('form.inline select').forEach(sel => { sel.addEventListener('change', () => { const msg = document.createElement('span'); msg.textContent = '✔ Gespeichert'; msg.className = 'status-toast'; sel.parentElement.appendChild(msg); setTimeout(() => msg.remove(), 2500); }); }); }); </script>

</body>
</html>